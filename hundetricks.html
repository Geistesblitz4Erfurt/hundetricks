<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meine Hunde-Trickkiste</title>
    <style>
        :root {
            --primary: #2196F3;
            --bg: #f4f7f6;
            --text: #333;
            --card-bg: #fff;
            
            /* Kategorie Farben */
            --beginner-bg: #e8f5e9; --beginner-border: #4CAF50;
            --advanced-bg: #fff3e0; --advanced-border: #FF9800;
            --pro-bg: #ffebee; --pro-border: #F44336;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        /* --- Header & Progress --- */
        header {
            background: #fff;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem;
            text-align: center;
        }

        h1 { margin: 0 0 10px 0; font-size: 1.5rem; color: var(--primary); }

        .progress-container {
            max-width: 800px;
            margin: 0 auto;
            background: #e0e0e0;
            border-radius: 20px;
            height: 20px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 0.9rem;
            margin-top: 5px;
            font-weight: bold;
            color: #666;
        }

        /* --- Main Content --- */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
            padding-bottom: 80px;
        }

        /* --- Accordion / Category Header --- */
        .category-group {
            margin-bottom: 15px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .category-header {
            padding: 20px;
            font-size: 1.3rem;
            color: #444;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
            border-left: 8px solid transparent;
            background: #fff;
            transition: background 0.2s;
        }

        .category-header:hover {
            background: #f9f9f9;
        }

        /* Farben f√ºr die Header-R√§nder */
        .category-header.beginner { border-left-color: var(--beginner-border); }
        .category-header.advanced { border-left-color: var(--advanced-border); }
        .category-header.pro { border-left-color: var(--pro-border); }

        .arrow {
            font-size: 0.9rem;
            transition: transform 0.3s ease;
            color: #888;
        }

        /* Offener Zustand f√ºr den Pfeil */
        .category-header.active .arrow {
            transform: rotate(180deg);
        }

        .category-content {
            display: none; /* Standardm√§√üig ausgeblendet */
            padding: 0 20px 20px 20px;
            background: #fafafa;
            border-top: 1px solid #eee;
        }

        /* Wenn aktiv, anzeigen (wird per JS gesteuert) */
        .category-content.open {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Trick Card --- */
        .trick-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px; /* Abstand zwischen Karten */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #eee;
            transition: transform 0.2s, opacity 0.3s;
        }

        /* Gelernt-Status Style */
        .trick-card.learned {
            opacity: 0.6;
            background: #f0f0f0;
        }
        .trick-card.learned h3 { text-decoration: line-through; color: #888; }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .trick-title {
            margin: 0;
            font-size: 1.2rem;
            color: #333;
        }

        .badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #eee;
            color: #666;
            text-transform: uppercase;
            font-weight: bold;
        }

        /* --- Details Section --- */
        .details { margin-top: 15px; }
        
        .detail-row { margin-bottom: 12px; }
        .detail-label { font-weight: bold; font-size: 0.9rem; color: #555; display: block; margin-bottom: 3px; }
        .detail-content { font-size: 1rem; color: #444; }

        .tip-box {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 10px 15px;
            margin-top: 15px;
            font-size: 0.95rem;
            color: #0d47a1;
            display: flex;
            gap: 10px;
        }
        .tip-icon { font-size: 1.2rem; flex-shrink: 0; }

        /* --- Checkbox Toggle --- */
        .check-wrapper {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            cursor: pointer;
            user-select: none;
        }

        .check-label {
            margin-right: 10px;
            font-weight: bold;
            color: var(--text);
        }

        /* Custom Checkbox */
        .toggle-btn {
            width: 50px;
            height: 28px;
            background: #ccc;
            border-radius: 30px;
            position: relative;
            transition: background 0.3s;
        }
        .toggle-circle {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Active State */
        .check-wrapper.active .toggle-btn { background: #4CAF50; }
        .check-wrapper.active .toggle-circle { left: 24px; }
        .check-wrapper.active .check-label { color: #4CAF50; }

        /* Loader */
        #loader { text-align: center; padding: 50px; font-size: 1.2rem; color: #666; }
        .error { color: red; text-align: center; padding: 20px; }

    </style>
</head>
<body>

    <header>
        <h1>üêï Trickkiste & Fortschritt</h1>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="progress-text" id="progressText">Lade Daten...</div>
    </header>

    <div id="loader">Lade Hundetricks...</div>
    <div id="app" class="container"></div>

    <script>
        // --- KONFIGURATION ---
        const JSON_URL = 'https://raw.githack.com/Geistesblitz4Erfurt/hundetricks/main/Hundetricks.json';
        const STORAGE_KEY = 'hundeTricksProgress_v1';

        // --- STATE ---
        let allTricks = [];
        let learnedTricks = new Set();

        // --- INITIALISIERUNG ---
        window.addEventListener('DOMContentLoaded', init);

        async function init() {
            loadProgress(); // Aus LocalStorage laden
            
            try {
                const response = await fetch(JSON_URL);
                if(!response.ok) throw new Error("Netzwerkfehler");
                const data = await response.json();
                
                processData(data);
                renderApp();
            } catch (error) {
                document.getElementById('loader').innerHTML = `<div class="error">Fehler beim Laden der Tricks.<br>Bitte √ºberpr√ºfe deine Internetverbindung.<br><small>${error.message}</small></div>`;
            }
        }

        // --- DATENVERARBEITUNG ---
        function processData(data) {
            const db = data.trick_database;
            
            const extract = (key, catObj) => {
                if(!catObj || !catObj.list) return [];
                return catObj.list.map(trick => ({
                    ...trick,
                    categoryKey: key, 
                    categoryName: catObj.meta.category_name,
                    colorCode: catObj.meta.color_code
                }));
            };

            const beginners = extract('beginner', db.beginner);
            const advanced = extract('advanced', db.advanced);
            const pros = extract('pro', db.pro);

            allTricks = [...beginners, ...advanced, ...pros];
            document.getElementById('loader').style.display = 'none';
        }

        // --- RENDERING ---
        function renderApp() {
            const app = document.getElementById('app');
            app.innerHTML = '';

            const categories = [
                { key: 'beginner', title: 'üå± Basistricks f√ºr Anf√§nger', colorClass: 'beginner' },
                { key: 'advanced', title: '‚≠ê Tricks f√ºr Fortgeschrittene', colorClass: 'advanced' },
                { key: 'pro', title: 'üèÜ Tricks f√ºr Profis', colorClass: 'pro' }
            ];

            categories.forEach(cat => {
                const tricksInCat = allTricks.filter(t => t.categoryKey === cat.key);
                
                if(tricksInCat.length > 0) {
                    // Container f√ºr die gesamte Kategorie
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'category-group';

                    // 1. Der Header (Klickbar)
                    const header = document.createElement('div');
                    header.className = `category-header ${cat.colorClass}`;
                    header.innerHTML = `
                        <span>${cat.title} (${tricksInCat.length})</span>
                        <span class="arrow">‚ñº</span>
                    `;

                    // 2. Der Inhalt (Standardm√§√üig versteckt)
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'category-content'; 
                    // Hinweis: display:none ist im CSS gesetzt, aber hier stellen wir sicher
                    // dass es initial zu ist.
                    
                    // Klick-Logik f√ºr Akkordeon
                    header.onclick = () => {
                        const isOpen = contentDiv.classList.contains('open');
                        if (isOpen) {
                            contentDiv.classList.remove('open');
                            header.classList.remove('active');
                        } else {
                            contentDiv.classList.add('open');
                            header.classList.add('active');
                        }
                    };

                    // Tricks in den Content-Bereich einf√ºgen
                    tricksInCat.forEach(trick => {
                        contentDiv.appendChild(createTrickCard(trick));
                    });

                    // Alles zusammenbauen
                    groupDiv.appendChild(header);
                    groupDiv.appendChild(contentDiv);
                    app.appendChild(groupDiv);
                }
            });

            updateStats();
        }

        function createTrickCard(trick) {
            const isLearned = learnedTricks.has(trick.id);
            const div = document.createElement('div');
            div.className = `trick-card ${isLearned ? 'learned' : ''}`;
            div.id = `card-${trick.id}`;

            div.innerHTML = `
                <div class="card-header">
                    <h3 class="trick-title">${trick.titel}</h3>
                    <span class="badge">#${trick.id}</span>
                </div>

                <div class="details">
                    <div class="detail-row">
                        <span class="detail-label">Bewegungsablauf:</span>
                        <div class="detail-content">${trick.bewegungsablauf}</div>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Endposition:</span>
                        <div class="detail-content">${trick.endposition}</div>
                    </div>
                    
                    <div class="tip-box">
                        <span class="tip-icon">üí°</span>
                        <div><strong>Tipp:</strong> ${trick.trainingstipps}</div>
                    </div>
                </div>

                <div class="check-wrapper ${isLearned ? 'active' : ''}" onclick="toggleTrick('${trick.id}')">
                    <span class="check-label" id="label-${trick.id}">${isLearned ? 'Gelernt!' : 'Noch lernen'}</span>
                    <div class="toggle-btn">
                        <div class="toggle-circle"></div>
                    </div>
                </div>
            `;

            return div;
        }

        // --- LOGIK & STORAGE ---

        window.toggleTrick = function(id) {
            const card = document.getElementById(`card-${id}`);
            const wrapper = card.querySelector('.check-wrapper');
            const label = document.getElementById(`label-${id}`);

            if (learnedTricks.has(id)) {
                learnedTricks.delete(id);
                card.classList.remove('learned');
                wrapper.classList.remove('active');
                label.innerText = "Noch lernen";
            } else {
                learnedTricks.add(id);
                card.classList.add('learned');
                wrapper.classList.add('active');
                label.innerText = "Gelernt!";
            }

            saveProgress();
            updateStats();
        };

        function updateStats() {
            const total = allTricks.length;
            const done = learnedTricks.size;
            const percent = total === 0 ? 0 : Math.round((done / total) * 100);

            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressText').innerText = `${done} von ${total} Tricks gelernt (${percent}%)`;
        }

        function saveProgress() {
            const dataToSave = JSON.stringify(Array.from(learnedTricks));
            localStorage.setItem(STORAGE_KEY, dataToSave);
        }

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    learnedTricks = new Set(parsed);
                } catch (e) {
                    console.error("Fehler beim Laden des Speicherstands", e);
                    learnedTricks = new Set();
                }
            }
        }
    </script>
</body>
</html>